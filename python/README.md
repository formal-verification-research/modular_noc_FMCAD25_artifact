# Python Scripts

This directory contains two small Python libraries that we developed to facilitate
modular development of our NoC model in the Modest language. The first library,
[noc.py](noc.py), provides a simple interface for generating arbitrary nxn NoC
models in the Modest language. The second library, [modest.py](modest.py) provides
a basic interface to the Modest Toolset from Python. When characterizing PSN,
Modest requires that a separate property is generated for each clock cycle, so
it's advantageous to automate that.

PSN characterization for the 2x2, 3x3, and 4x4 NoCs can be generated by running
`python fmcad.py` from this directory, assuming that `modest` is located on
your path. [fmcad.py](fmcad.py) also acts as an example for how we use the Noc
and Modest libraries in Python to automate generating results.

Additionally, this directory contains a script, [example.py](example.py), that
provides an example of how to use each of the libraries to generate a NoC model,
characterize PSN, and ensure functional correctness. Running this file should
take approximately 10 minutes to complete.

[plot.py](plot.py) allows for plotting the results generated by
[fmcad.py](fmcad.py) to visually compare results to the results presented in
the paper.

## [noc](noc.py) Library

Exposes the `Noc` class that can be used to generate arbitrary nxn NoC models in
the Modest language.

### Example

```python
from noc import *

_2x2 = Noc(2)

with open("2x2.modest", "w") as f:
    f.write(_2x2.print())
```

### `constructor`

```python
class Noc:
  def __init__(self, size: int, *, 
                     buffer_size: int = 4,
                     activity_thresh: int = 3,
                     injection_rate_numerator: int = 3,
                     injection_rate_denominator: int = 10,
                     resistive_noise_threshold: int = 1,
                     inductive_noise_threshold: int = 1)
```

Initialize a NoC design with the specified design parameters.

Inputs:

- `size`: (int)  n for a given nxn NoC i.e. 2 for a 2x2 NoC.
- `buffer_size`: (int)  The length of the buffers in each router.
- `activity_thresh`: (int) The threshold at which the activity counter is updated.
- `injection_rate_numerator`: (int) The number of clock cycles to inject flits in
  during `injection_rate_denominator` cycles.
- `injection_rate_denominator`: (int) The length of the flit injection rate cycle.
- `resistive_noise_threshold`: (int) The threshold at which a resistive noise PSN event
  is generated.
- `inductive_noise_threshold`: (int) The threshold at which a inductive noise PSNevent
  is generated.

## [modest](modest.py) Library

Exposes the following methods:

### `check`

```python
def check(model: str | Path, output_path: Path | None = None) -> str
```

Runs `modest check` on the given `model` argument and returns the output of
`modest check` as a string.

Inputs:

- `model`: Either the model as a string (useful when using the NoC library) or
  the filepath to the model file (ending in .modest).
- `output_path`: the location to store the output. If not specified the output
  is only returned as a string.

Returns:

- `modest check` output as a string.

### `simulate`

```python
def simulate(model: str | Path, output_path: Path | None = None) -> str
```

Runs `modest simulate` on the given `model` argument and returns the output of
`modest check` as a string.

Inputs:

- `model`: Either the model as a string (useful when using the NoC library) or
  the filepath to the model file (ending in .modest).
- `output_path`: the location to store the output. If not specified the output
  is only returned as a string.

Returns:

- `modest check` output as a string.
